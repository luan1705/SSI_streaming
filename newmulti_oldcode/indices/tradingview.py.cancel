from sqlalchemy import create_engine
import pandas as pd
import logging

logging.basicConfig(
    level=logging.INFO,                 # c·∫•p log: DEBUG / INFO / WARNING / ERROR
    format="%(asctime)s [%(levelname)s] %(message)s",  # format log
    handlers=[
        logging.StreamHandler()         # in ra console
        # c√≥ th·ªÉ th√™m FileHandler n·∫øu mu·ªën ghi log ra file
    ]
)

enginedb=create_engine('postgresql://vnsfintech:%40Vns123456@videv.cloud:5432/vnsfintech')

def tradingview(symbol):
    try:    
        logging.info('K·∫øt n·ªëi DB')
        df = pd.read_sql(f'SELECT "symbol","close" FROM "history_tradingview"."{symbol}_1D" ORDER BY time DESC LIMIT 1', con=enginedb)
        logging.info('ƒê√£ l·∫•y activity_HNX')
        return df
    except Exception as E:
        logging.exception('L·ªói l∆∞u activity_HNX')
    finally:
        enginedb.dispose()
        logging.info("üîí ƒê√£ ƒë√≥ng k·∫øt n·ªëi DB")

if __name__ == "__main__":
    symbol = 'VN30'
    tradingview(symbol)